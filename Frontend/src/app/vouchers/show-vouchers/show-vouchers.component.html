<div *ngIf="isAdmin; then forAdmin else forUser">
    
</div>
<ng-template #forUser>
    User Logged in: {{this.userName}}
</ng-template>
<ng-template #forAdmin>
    <p>Admin is logged in</p>
</ng-template>
<div *ngIf="!isAdmin" class="text-end">
    <!-- "Add New" button aligned to the right -->
    <a class="btn btn-success" routerLink="/vouchers/add-voucher">Add New</a>
</div>

<div class="container mt-4">
    <!-- Table for displaying vouchers -->
    <table class="table table-bordered table-active table-striped table-hover">
        <thead>
            <tr>
                <th>Voucher No.</th>
                <th *ngIf="isAdmin">User</th>
                <th>Date</th>
                <th>Customer</th>
                <th></th> <!-- Empty header for action buttons -->
            </tr>
        </thead>
        <tbody>
            <!-- Voucher rows will be inserted dynamically using JS -->
            <ng-container *ngFor="let voucher of this.vouchers; let i = index">
                <tr>
                    <td>{{i + 1}}</td>
                    <td *ngIf="isAdmin">{{voucher.userName}}</td>
                    <td>{{voucher.date | dateFormat}}</td>
                    <td>{{voucher.customer}}</td>
                    <td class="text-end">
                        <!-- Expand/collapse button -->
                        <div *ngIf="voucher.expanded; then collapse else view">

                        </div>
                        <ng-template #view>
                            <div class="btn btn-success" (click)="toggleVoucher(i)">
                                <i class="bi bi-arrow-right-short"></i> View
                            </div>
                        </ng-template>
                        <ng-template #collapse>
                            <div  class="btn btn-success" (click)="toggleVoucher(i)">
                                <i class="bi bi-arrow-down-short"></i> View
                            </div>
                        </ng-template>
                        <!-- Edit button -->
                        <div class="edit-btn btn btn-primary" (click)="editVoucher(i)">Edit</div>
                        <!-- Delete button -->
                        <div *ngIf="isAdmin" class="del-btn btn btn-danger" (click)="deleteVoucher(i)">Delete</div>
                    </td>
                </tr>
                <tr *ngIf="voucher.expanded">
                    <td colspan="5"> <!-- Span all 5 columns (includes User column) -->
                        <div class="details-container">
                            <table class="table table-sm table-striped">
                                <thead class="sticky-top"> <!-- keeps header visible while scrolling -->
                                    <tr>
                                        <th>Item No</th>
                                        <th>Quantity</th>
                                        <th>Price</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <ng-container *ngFor="let order of voucher.orders">
                                        <tr>
                                            <td>{{order.item}}</td>
                                            <td>{{order.quantity}}</td>
                                            <td>{{order.price}}</td>
                                            <td>{{order.price * order.quantity}}</td>
                                        </tr>
                                    </ng-container>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
            </ng-container>
        </tbody>
    </table>
</div>